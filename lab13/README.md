# Лабораторная работа №13 - Слепая подпись для анонимного голосования

## Описание алгоритма

Слепая подпись - это криптографический протокол, позволяющий подписывать сообщения, не зная их содержания. В системе анонимного голосования это обеспечивает анонимность голосующих при сохранении возможности проверки подлинности голосов.

### Принцип работы

1. **Генерация ключей сервера**:
   - Сервер генерирует пару RSA ключей `(n, e, d)`
   - Открытый ключ `(n, e)` публикуется
   - Секретный ключ `d` хранится сервером

2. **Процесс голосования**:
   - Голосующий выбирает вариант ответа (Да/Нет/Воздержался)
   - Кодирует выбор в число (1/2/3)
   - Генерирует слепой фактор `r` (случайное число взаимно простое с n)
   - Ослепляет сообщение: `m_blind = m * r^e mod n`
   - Отправляет ослепленное сообщение серверу

3. **Слепая подпись**:
   - Сервер подписывает ослепленное сообщение: `s_blind = m_blind^d mod n`
   - Возвращает подпись голосующему

4. **Снятие ослепления**:
   - Голосующий вычисляет обратный элемент: `r_inv = r^(-1) mod n`
   - Снимает ослепление: `s = s_blind * r_inv mod n`
   - Получает подпись исходного сообщения

5. **Проверка подписи**:
   - `m' = s^e mod n`
   - Подпись корректна, если `m' = m`

### Математические формулы

- `m_blind = m * r^e mod n` (ослепление)
- `s_blind = m_blind^d mod n` (слепая подпись)
- `s = s_blind * r^(-1) mod n` (снятие ослепления)
- `m' = s^e mod n` (проверка подписи)

## Пример работы алгоритма

### Простой пример

```python
# Параметры сервера
n = 33, e = 3, d = 7

# Голосующий выбирает "Да" (код = 1)
m = 1

# Голосующий генерирует слепой фактор
r = 5  # взаимно простое с 33

# Ослепление сообщения
m_blind = (1 * 5^3) mod 33 = (1 * 125) mod 33 = 125 mod 33 = 26

# Сервер подписывает ослепленное сообщение
s_blind = 26^7 mod 33 = 8031810176 mod 33 = 26

# Голосующий снимает ослепление
r_inv = 5^(-1) mod 33 = 20  # 5 * 20 = 100 ≡ 1 mod 33
s = (26 * 20) mod 33 = 520 mod 33 = 25

# Проверка подписи
m_check = 25^3 mod 33 = 15625 mod 33 = 1
# m_check = 1 = m, подпись корректна ✓
```

### Реальный пример с большими числами

```python
# Параметры сервера
p = 1000000007
q = 1000000009
n = p * q = 1000000016000000063
e = 65537
d = pow(e, -1, (p-1)*(q-1))

# Голосующий выбирает "Нет" (код = 2)
m = 2

# Генерация слепого фактора
r = random.randint(2, n-1)
while gcd(r, n) != 1:
    r = random.randint(2, n-1)

# Ослепление
m_blind = (m * pow(r, e, n)) % n

# Слепая подпись сервера
s_blind = pow(m_blind, d, n)

# Снятие ослепления
r_inv = pow(r, -1, n)
s = (s_blind * r_inv) % n

# Проверка
m_check = pow(s, e, n)
assert m_check == m  # Подпись корректна
```

## Пример системы голосования

```python
# Серверная часть
class BlindSignatureServer:
    def __init__(self):
        self.generate_keys()
        self.voters = {}
        self.votes = []
    
    def register_voter(self, voter_id):
        self.voters[voter_id] = {'registered': True, 'voted': False}
    
    def blind_sign(self, blinded_message, voter_id):
        if voter_id not in self.voters or self.voters[voter_id]['voted']:
            return None
        return pow(blinded_message, self.d, self.n)
    
    def submit_vote(self, vote, signature, voter_id):
        # Проверка подписи
        if pow(signature, self.e, self.n) == vote_code:
            self.votes.append({'vote': vote, 'voter_id': voter_id})
            self.voters[voter_id]['voted'] = True
            return True
        return False

# Клиентская часть
class BlindSignatureClient:
    def __init__(self, voter_id, server):
        self.voter_id = voter_id
        self.server = server
    
    def vote(self, choice):
        choice_code = {"Да": 1, "Нет": 2, "Воздержался": 3}[choice]
        
        # Ослепление
        r = self.generate_blind_factor()
        blinded_msg = (choice_code * pow(r, self.server.e, self.server.n)) % self.server.n
        
        # Получение слепой подписи
        blind_sig = self.server.blind_sign(blinded_msg, self.voter_id)
        
        # Снятие ослепления
        r_inv = pow(r, -1, self.server.n)
        signature = (blind_sig * r_inv) % self.server.n
        
        # Подача голоса
        return self.server.submit_vote(choice, signature, self.voter_id)
```

## Запуск программы

```bash
# Графический интерфейс
python lab13.py

# Демонстрация слепой подписи
python lab13.py --demo
```

## Особенности реализации

- Графический интерфейс с tkinter
- Разделение на серверную и клиентскую части
- Поддержка вариантов: Да, Нет, Воздержался
- Полная анонимность голосующих
- Проверка подлинности голосов
- Визуализация процесса слепой подписи

## Преимущества слепой подписи

1. **Анонимность**: Сервер не знает, за что голосует конкретный голосующий
2. **Подлинность**: Все голоса подписаны сервером и проверяемы
3. **Неотслеживаемость**: Невозможно связать голос с конкретным голосующим
4. **Целостность**: Невозможно подменить голоса после подписания
