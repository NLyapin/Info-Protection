# Лабораторная работа №7 - Шифр Вернама

## Описание алгоритма

Шифр Вернама (одноразовый блокнот) - это симметричный криптографический алгоритм, который обеспечивает теоретически совершенную секретность. Ключ генерируется с использованием протокола Диффи-Хеллмана.

### Принцип работы

1. **Генерация ключа через Диффи-Хеллман**:
   - Выбирается простое число `p` и первообразный корень `g`
   - Алиса выбирает секретный ключ `xa`, Боб выбирает `xb`
   - Алиса вычисляет `ya = g^xa mod p`, Боб вычисляет `yb = g^xb mod p`
   - Общий ключ: `K = yb^xa mod p = ya^xb mod p`

2. **Генерация ключа для шифра Вернама**:
   - Используется хеш-функция SHA-256 для получения ключа нужной длины
   - Ключ генерируется на основе общего ключа Диффи-Хеллмана

3. **Шифрование/Расшифровка**: `C = M ⊕ K`, `M = C ⊕ K`

### Математические формулы

- `ya = g^xa mod p` (открытый ключ Алисы)
- `yb = g^xb mod p` (открытый ключ Боба)
- `K = yb^xa mod p = ya^xb mod p` (общий ключ)
- `C = M ⊕ K` (шифрование)
- `M = C ⊕ K` (расшифровка)

## Пример работы алгоритма

### Простой пример

```python
# Параметры Диффи-Хеллмана
p = 7          # простое число
g = 3          # первообразный корень
xa = 4         # секретный ключ Алисы
xb = 5         # секретный ключ Боба

# Вычисляем открытые ключи
ya = 3^4 mod 7 = 81 mod 7 = 4
yb = 3^5 mod 7 = 243 mod 7 = 5

# Вычисляем общий ключ
K_alice = 5^4 mod 7 = 625 mod 7 = 2
K_bob = 4^5 mod 7 = 1024 mod 7 = 2

# Шифрование Вернама
M = 0b01010101  # сообщение (85 в десятичной)
K = 0b10101010  # ключ (170 в десятичной)
C = M ^ K = 0b11111111  # зашифрованное сообщение (255 в десятичной)

# Расшифровка
M_decrypted = C ^ K = 0b11111111 ^ 0b10101010 = 0b01010101
```

### Реальный пример с большими числами

```python
# Параметры Диффи-Хеллмана
p = 1000000007  # большое простое число
g = 2           # первообразный корень
xa = 123456789  # секретный ключ Алисы
xb = 987654321  # секретный ключ Боба

# Вычисляем открытые ключи
ya = 2^123456789 mod 1000000007
yb = 2^987654321 mod 1000000007

# Вычисляем общий ключ
K = yb^123456789 mod 1000000007

# Генерация ключа для шифра Вернама
key_bytes = K.to_bytes((K.bit_length() + 7) // 8, 'big')
hash_obj = hashlib.sha256(key_bytes)
vernam_key = hash_obj.digest()

# Шифрование файла
for i, byte in enumerate(file_data):
    encrypted_byte = byte ^ vernam_key[i % len(vernam_key)]
```

## Запуск программы

```bash
# Демонстрация
python lab7.py --mode demo

# Шифрование файла
python lab7.py --mode encrypt --input file.txt --output encrypted.txt

# Расшифровка файла
python lab7.py --mode decrypt --input encrypted.txt --output decrypted.txt
```

## Особенности реализации

- Использование безопасных простых чисел
- Автоматический поиск первообразных корней
- Генерация ключей через SHA-256
- Поддержка файлов любого размера
- Теоретически совершенная секретность
