# Лабораторная работа №5 - Шифр Эль-Гамаля

## Описание алгоритма

Шифр Эль-Гамаля - это асимметричный криптографический алгоритм, основанный на проблеме дискретного логарифма. Он использует простое число `p`, первообразный корень `g` и секретный ключ `C2`.

### Принцип работы

1. **Генерация ключей**:
   - Выбирается простое число `p` и первообразный корень `g`
   - Генерируется секретный ключ `C2` (случайное число от 2 до p-2)
   - Вычисляется открытый ключ `D2 = g^C2 mod p`

2. **Шифрование**: Для сообщения `M`:
   - Выбирается случайное `k` (от 2 до p-2)
   - `r = g^k mod p`
   - `e = M * D2^k mod p`
   - Пара `(r, e)` - зашифрованное сообщение

3. **Расшифровка**:
   - `M = e * r^(-C2) mod p`

### Математические формулы

- `D2 = g^C2 mod p` (открытый ключ)
- `r = g^k mod p` (случайный элемент)
- `e = M * D2^k mod p` (зашифрованное сообщение)
- `M = e * r^(-C2) mod p` (расшифровка)

## Пример работы алгоритма

### Простой пример

```python
# Параметры
p = 7          # простое число
g = 3          # первообразный корень
C2 = 4         # секретный ключ
M = 2          # сообщение

# Вычисляем открытый ключ
D2 = 3^4 mod 7 = 81 mod 7 = 4

# Шифрование
k = 5          # случайное число
r = 3^5 mod 7 = 243 mod 7 = 5
e = 2 * 4^5 mod 7 = 2 * 1024 mod 7 = 2 * 2 mod 7 = 4

# Расшифровка
r_inv = 5^(-4) mod 7 = 5^(7-1-4) mod 7 = 5^2 mod 7 = 25 mod 7 = 4
M_decrypted = 4 * 4 mod 7 = 16 mod 7 = 2
```

### Реальный пример с большими числами

```python
# Параметры
p = 1000000007  # большое простое число
g = 2           # первообразный корень
C2 = 123456789  # секретный ключ
M = 12345       # сообщение

# Вычисляем открытый ключ
D2 = 2^123456789 mod 1000000007

# Шифрование
k = 987654321   # случайное число
r = 2^987654321 mod 1000000007
e = 12345 * D2^987654321 mod 1000000007

# Расшифровка
r_inv = r^(p-1-C2) mod p
M_decrypted = e * r_inv mod p
```

## Запуск программы

```bash
# Демонстрация
python lab5.py --mode demo

# Шифрование файла
python lab5.py --mode encrypt --input file.txt --output encrypted.txt

# Расшифровка файла
python lab5.py --mode decrypt --input encrypted.txt --output decrypted.txt
```

## Особенности реализации

- Использование безопасных простых чисел (p = 2q + 1)
- Автоматический поиск первообразных корней
- Каждый байт файла шифруется с новым случайным `k`
- Поддержка больших чисел
